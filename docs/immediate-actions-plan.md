# План первоочередных шагов для запуска проекта ВБЗ

## Подготовительные действия (1-2 дня)

1. **Создание репозитория и базовой структуры проекта**
   - Инициализация Git-репозитория
   - Настройка .gitignore для Python-проекта
   - Создание основной структуры каталогов согласно плану

2. **Настройка окружения разработки**
   - Создание виртуального окружения Python
   ```bash
   python -m venv venv
   source venv/bin/activate  # Для Linux/Mac
   # venv\Scripts\activate   # Для Windows
   ```
   - Установка базовых зависимостей и инструментов разработки
   ```bash
   pip install python-magic watchdog typer rich sqlalchemy pytest black isort mypy
   ```
   - Создание requirements.txt с точными версиями
   - Настройка линтеров и форматтеров (black, isort, mypy)

3. **Создание файла конфигурации**
   - Разработка базового конфигурационного файла в YAML
   - Включение настроек для путей к данным, параметров сканирования и логирования
   - Создание системы загрузки конфигурации с переопределением из переменных окружения

## Фаза 1: Базовый сканер и схема базы данных (3-4 дня)

1. **Разработка схемы базы данных SQLite**
   - Создание скрипта для инициализации схемы
   - Реализация базовых таблиц: files, content
   - Разработка моделей SQLAlchemy для таблиц
   - Создание менеджера соединений с БД
   - Тестирование базовых операций CRUD

2. **Реализация базового сканера директорий**
   - Создание класса для рекурсивного обхода директорий
   - Реализация функций хеширования файлов (SHA-256)
   - Определение MIME-типов с помощью python-magic
   - Базовая фильтрация файлов по размеру и расширению
   - Сохранение информации о файлах в БД

3. **Интеграция с системой логирования**
   - Настройка логирования с разными уровнями
   - Создание форматтеров для вывода в консоль и файл
   - Настройка ротации логов

## Фаза 2: Экстракторы текста (4-5 дней)

1. **Установка библиотек для извлечения текста**
   ```bash
   pip install unstructured PyMuPDF python-docx openpyxl python-pptx
   ```

2. **Разработка базового интерфейса экстрактора**
   - Создание абстрактного класса BaseExtractor
   - Определение общего интерфейса для всех экстракторов
   - Разработка системы фабрик для выбора экстрактора по типу файла

3. **Реализация универсального экстрактора с unstructured**
   - Интеграция библиотеки unstructured для основных форматов
   - Извлечение текста и метаданных
   - Сохранение результатов в БД
   - Базовая оценка качества извлечения

4. **Специализированные экстракторы (при необходимости)**
   - Реализация экстрактора для PDF на основе PyMuPDF
   - Создание экстракторов для офисных форматов
   - Тестирование на различных типах документов

## Фаза 3: Базовый CLI и тестирование (3-4 дня)

1. **Разработка CLI с Typer**
   - Создание основной структуры команд
   - Реализация команд для сканирования и индексации
   - Добавление форматированного вывода с rich
   - Настройка справки и документации команд

2. **Интеграция компонентов**
   - Объединение сканера, БД и экстракторов в единый пайплайн
   - Реализация потока обработки файлов
   - Настройка обработки ошибок и восстановления

3. **Создание тестов**
   - Разработка модульных тестов для основных компонентов
   - Создание интеграционных тестов для пайплайна
   - Настройка тестовых данных

4. **Первый запуск на тестовой директории**
   - Выбор набора тестовых файлов разных форматов
   - Запуск полного пайплайна
   - Анализ результатов и проблем
   - Корректировка и оптимизация

## Фаза 4: Настройка Qdrant и подготовка к Этапу 2 (2-3 дня)

1. **Установка и настройка Qdrant**
   ```bash
   docker run -d -p 6333:6333 -v $(pwd)/qdrant_data:/qdrant/storage qdrant/qdrant
   pip install qdrant-client
   ```

2. **Базовая интеграция с Qdrant**
   - Создание класса-клиента для работы с Qdrant
   - Настройка коллекции с нужными параметрами
   - Тестирование соединения и базовых операций

3. **Документирование и рефакторинг**
   - Обновление документации
   - Рефакторинг и оптимизация кода
   - Создание README с инструкциями по установке и запуску

## Последовательность задач для быстрого старта

### День 1-2: Базовая инфраструктура
- Инициализация репозитория и структуры
- Настройка окружения и зависимостей
- Создание файла конфигурации
- Настройка логирования

### День 3-4: Сканер и БД
- Создание схемы базы данных
- Реализация моделей SQLAlchemy
- Базовый сканер директорий
- Функции хеширования и определения типов

### День 5-7: Экстракторы текста
- Интерфейс экстрактора
- Универсальный экстрактор на основе unstructured
- Экстрактор для PDF на основе PyMuPDF
- Тестирование на разных форматах

### День 8-10: CLI и интеграция
- Базовый CLI с Typer
- Интеграция компонентов
- Создание тестов
- Первый запуск на тестовой директории
- Анализ результатов и корректировка

### День 11-12: Подготовка к Этапу 2
- Настройка Qdrant
- Базовая интеграция с векторной БД
- Документирование
- Планирование следующего этапа

## Минимальный набор файлов для запуска

```
doc_vbz/
├── config/
│   └── config.yaml               # Основная конфигурация
├── src/
│   ├── __init__.py
│   ├── config.py                 # Загрузка конфигурации
│   ├── scanner/
│   │   ├── __init__.py
│   │   └── file_scanner.py       # Сканер файлов
│   ├── storage/
│   │   ├── __init__.py
│   │   ├── db.py                 # Соединение с SQLite
│   │   ├── models.py             # Модели SQLAlchemy
│   │   └── schema.py             # Схема базы данных
│   ├── extractors/
│   │   ├── __init__.py
│   │   ├── base.py               # Базовый класс экстрактора
│   │   └── universal.py          # Универсальный экстрактор
│   ├── utils/
│   │   ├── __init__.py
│   │   ├── logging.py            # Настройка логирования
│   │   └── hash.py               # Функции хеширования
│   └── cli/
│       ├── __init__.py
│       └── commands.py           # CLI-команды
├── scripts/
│   └── setup_db.py               # Инициализация БД
├── tests/
│   ├── test_scanner.py
│   └── test_extractors.py
├── requirements.txt
└── main.py                       # Входная точка
```

## Критические аспекты для успешного старта

1. **Качество извлечения текста**
   - Тщательно тестировать на разных форматах документов
   - Отмечать в базе качество извлечения для дальнейшего анализа
   - Сохранять структурированные данные, если возможно

2. **Надежное хранение метаданных**
   - Продуманная схема БД с учетом будущего расширения
   - Корректное хранение путей к файлам с учетом разных ОС
   - Полные метаданные для облегчения последующего анализа

3. **Оптимизация скорости работы**
   - Оптимизированное хеширование файлов
   - Эффективное определение MIME-типов
   - Параллельная обработка, где это возможно

4. **Обработка ошибок**
   - Надежное логирование ошибок
   - Механизмы восстановления после сбоев
   - Корректное завершение работы при ошибках

## Ожидаемые результаты первых двух недель

1. Функционирующий сканер директорий, способный рекурсивно обходить указанные пути
2. Настроенная база данных SQLite с базовой схемой для файлов и контента
3. Работающие экстракторы текста для основных форматов (PDF, DOCX, XLSX, TXT)
4. Простой CLI-интерфейс для запуска сканирования и просмотра результатов
5. Начальная интеграция с Qdrant для подготовки к этапу индексации

Этот план позволит быстро получить прототип системы, который затем можно будет последовательно расширять согласно полному плану проекта.
